---
title: "R Notebook"
output: html_notebook
---

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library("ggpubr")
```

Experiment on both CIFAR10 and CIFAR100 datasets.
This experiment was performed in 10 replications for CIFAR100 and 1 replication for CIFAR10. Difference is due to different size of LDA training sets for each dataset. We use 50 samples per class for both datasets. Neural networks were trained on half of the original training set. The split was made randomly in each replication. Three neural networks were trained in each replication. These networks were then combined using WeightedLDAEnsemble. Original training set was then divided into folds, each of them cntaining 50 samples of each class. Half of these folds belongs to training set of the networks and half to the created validation set. In the experiment we compare the performance of ensemble between folds which belong to the training set and which belong to the validation set.

# CIFAR100

```{r}
net_results <- read.csv("D:/skola/1/weighted_ensembles/test_cifar_2021/train_data_half_c100//net_accuracies.csv")
ens_results <- read.csv("D:/skola/1/weighted_ensembles/test_cifar_2021/train_data_half_c100/ensemble_accuracies.csv")
```
```{r}
box_acc <- ggplot() + geom_boxplot(data=ens_results, mapping = aes(x=train_set, y=accuracy)) + facet_wrap(~method)
box_acc
```

```{r}
box_nll <- ggplot() + geom_boxplot(data=ens_results, mapping = aes(x=train_set, y=nll)) + facet_wrap(~method)
box_nll
```

```{r}
box_net_acc <- ggplot() + geom_boxplot(data=net_results, mapping=aes(x=network, y=accuracy))
box_net_acc
```

```{r}
box_net_nll <- ggplot() + geom_boxplot(data=net_results, mapping=aes(x=network, y=nll))
box_net_nll
```

```{r}
ens_results_wide <- pivot_wider(ens_results, names_from = c(train_set, method), values_from = c(accuracy, nll))
ens_results_wide
```

Testing statistical significance of difference for training on validation and train data
Since ensembles in each replication are trained on the same set of networks, we use paired t-test.

```{r}
differences <- data.frame(ens_results_wide$accuracy_vt_m1 - ens_results_wide$accuracy_tt_m1, ens_results_wide$accuracy_vt_m2 - ens_results_wide$accuracy_tt_m2,
                          ens_results_wide$accuracy_vt_m2_iter - ens_results_wide$accuracy_tt_m2_iter, 
                          ens_results_wide$accuracy_vt_bc - ens_results_wide$accuracy_tt_bc,
                          ens_results_wide$nll_vt_m1 - ens_results_wide$nll_tt_m1, ens_results_wide$nll_vt_m2 - ens_results_wide$nll_tt_m2,
                          ens_results_wide$nll_vt_m2_iter - ens_results_wide$nll_tt_m2_iter, ens_results_wide$nll_vt_bc - ens_results_wide$nll_tt_bc)
names(differences) <- c("acc_diff_m1", "acc_diff_m2", "acc_diff_m2_iter", "acc_diff_bc", "nll_diff_m1", "nll_diff_m2", "nll_diff_m2_iter", "nll_diff_bc")
differences
```

Ascertaining normality of differences

```{r}
ggdensity(differences$acc_diff_m1, xlab="acc diff m1")
```

```{r}
ggdensity(differences$acc_diff_m2, xlab="acc diff m2")
```

```{r}
ggdensity(differences$acc_diff_m2_iter, xlab="acc diff m2_iter")
```

```{r}
ggdensity(differences$acc_diff_bc, xlab="acc diff bc")
```

We have 50 samples, so we will consider the differences normal.

```{r}
t.test(ens_results_wide$accuracy_vt_m1, ens_results_wide$accuracy_tt_m1, paired=TRUE)
```

```{r}
t.test(ens_results_wide$accuracy_vt_m1, ens_results_wide$accuracy_tt_m1, paired=TRUE, alternative="less")
```

```{r}
t.test(ens_results_wide$accuracy_vt_m2, ens_results_wide$accuracy_tt_m2, paired=TRUE)
```

```{r}
t.test(ens_results_wide$accuracy_vt_m2, ens_results_wide$accuracy_tt_m2, paired=TRUE, alternative="less")
```

```{r}
t.test(ens_results_wide$accuracy_vt_m2_iter, ens_results_wide$accuracy_tt_m2_iter, paired=TRUE)
```

```{r}
t.test(ens_results_wide$accuracy_vt_bc, ens_results_wide$accuracy_tt_bc, paired=TRUE)
```

