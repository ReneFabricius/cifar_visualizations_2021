---
title: "R Notebook"
output: html_notebook
---

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library("ggpubr")
```

Experiment on CIFAR10 dataset.
This experiment was performed in 30 replications. In each replication a set of 500 samples from CIFAR10 training set was randomly chosen, with each class represented equally, this set is reffered to as validation set. This set was extracted from the CIFAR10 training set. Three neural networks were trained in the reduced training set. Theese networks were then combined using WeightedLDAEnsemble. For each replication, the ensemble was built twice. First LDA was trained on the extracted validation set and second on a randomly chosen set of 500 samples from the training set. These training sets are reffered to as vt and tt respectively.
This experiment focuses on the question, whether training LDA on the same set of data as the neural networks were trained on has any adverse effects to the performance of the ensemble as opposed to training on a different set.


```{r}
net_results <- read.csv("D:/skola/1/weighted_ensembles/test_cifar_2021/train_data/net_accuracies.csv")
ens_results <- read.csv("D:/skola/1/weighted_ensembles/test_cifar_2021/train_data/ensemble_accuracies.csv")
```

```{r}
box_acc <- ggplot() + geom_boxplot(data=ens_results, mapping = aes(x=train_set, y=accuracy)) + facet_wrap(~method)
box_acc
```

```{r}
box_nll <- ggplot() + geom_boxplot(data=ens_results, mapping = aes(x=train_set, y=nll)) + facet_wrap(~method)
box_nll
```

```{r}
box_net_acc <- ggplot() + geom_boxplot(data=net_results, mapping=aes(x=network, y=accuracy))
box_net_acc
```

```{r}
box_net_nll <- ggplot() + geom_boxplot(data=net_results, mapping=aes(x=network, y=nll))
box_net_nll
```

```{r}
ens_results_wide <- pivot_wider(ens_results, names_from = c(train_set, method), values_from = c(accuracy, nll))
ens_results_wide
```
Testing statistical significance of difference for training on validation and train data
Since ensembles in each replication are trained on the same set of networks, we use paired t-test.

```{r}
differences <- data.frame(ens_results_wide$accuracy_vt_m1 - ens_results_wide$accuracy_tt_m1, ens_results_wide$accuracy_vt_m2 - ens_results_wide$accuracy_tt_m2,
                          ens_results_wide$accuracy_vt_m2_iter - ens_results_wide$accuracy_tt_m2_iter, 
                          ens_results_wide$accuracy_vt_bc - ens_results_wide$accuracy_tt_bc,
                          ens_results_wide$nll_vt_m1 - ens_results_wide$nll_tt_m1, ens_results_wide$nll_vt_m2 - ens_results_wide$nll_tt_m2,
                          ens_results_wide$nll_vt_m2_iter - ens_results_wide$nll_tt_m2_iter, ens_results_wide$nll_vt_bc - ens_results_wide$nll_tt_bc)
names(differences) <- c("acc_diff_m1", "acc_diff_m2", "acc_diff_m2_iter", "acc_diff_bc", "nll_diff_m1", "nll_diff_m2", "nll_diff_m2_iter", "nll_diff_bc")
differences
```

Ascertaining normality of differences

```{r}
ggdensity(differences$acc_diff_m1, xlab="acc diff m1")
```
```{r}
ggdensity(differences$acc_diff_m2, xlab="acc diff m2")
```
```{r}
ggdensity(differences$acc_diff_m2_iter, xlab="acc diff m2_iter")
```
```{r}
ggdensity(differences$acc_diff_bc, xlab="acc diff bc")
```
```{r}
ggqqplot(differences$acc_diff_bc)
```
```{r}
shapiro.test(differences$acc_diff_bc)
```
Accuracy differences seem to be normal.

```{r}
t.test(ens_results_wide$accuracy_vt_m1, ens_results_wide$accuracy_tt_m1, paired=TRUE)
```
```{r}
t.test(ens_results_wide$accuracy_vt_m1, ens_results_wide$accuracy_tt_m1, paired=TRUE, alternative="less")
```
```{r}
t.test(ens_results_wide$accuracy_vt_m2, ens_results_wide$accuracy_tt_m2, paired=TRUE)
```
```{r}
t.test(ens_results_wide$accuracy_vt_m2, ens_results_wide$accuracy_tt_m2, paired=TRUE, alternative="less")
```
```{r}
t.test(ens_results_wide$accuracy_vt_m2_iter, ens_results_wide$accuracy_tt_m2_iter, paired=TRUE)
```
```{r}
t.test(ens_results_wide$accuracy_vt_bc, ens_results_wide$accuracy_tt_bc, paired=TRUE)
```





```{r}
ggdensity(differences$nll_diff_m1, xlab="nll diff m1")
```
```{r}
ggdensity(differences$nll_diff_m2, xlab="nll diff m2")
```
```{r}
ggdensity(differences$nll_diff_m2_iter, xlab="nll diff m2_iter")
```
```{r}
ggdensity(differences$nll_diff_bc, xlab="nll diff bc")
```




